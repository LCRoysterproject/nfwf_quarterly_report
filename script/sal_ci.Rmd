---
output:
  word_document:
    fig_width: 10
    fig_height: 10
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("tidyverse")
library("lubridate")
library("waterData")
library("dplyr")
library("ggplot2")
library("reshape2")
```


```{r salinity_data_processing, include=FALSE, warning=FALSE, message= FALSE}

# Sensor water quality carpentry
wq <- read.csv("C:\\Users\\Mel\\Desktop\\quarterly_report\\data\\wq.csv", header= T) %>%
  filter(Site != 0)

#Change class? of date and year
wq$Obs_Date <- as.POSIXct (wq$Obs_Date)

wq$year <- strftime(wq$Obs_Date, format = "%Y")

#Remove 2017
wq <- wq %>%
  subset(year %in% c('2018','2019')) %>%
  subset(Site %in% c(1:9))

#Calculate mean salinity by date and site
wq2 <- aggregate(Salinity ~ Obs_Date + Site, FUN = mean, data = wq) 

#Calculate the standard deviations for salinity by date and site
wq3 <- aggregate(Salinity ~ Obs_Date + Site, FUN = sd, data = wq)  

#Rename salinity sd to prevent redundant names
colnames(wq3)[colnames(wq3)=="Salinity"] <- "sal.sd"

#Add salinity sd vector to df with salinity mean values
wq2$sal.sd <- wq3$sal.sd

#Change the name of the mean salinity column
colnames(wq2)[colnames(wq2)=="Salinity"] <- "sal.mean"

# Water discharge carpentry (dynamically updating local discharge file)
station = '02323500' 
stinfo  = siteInfo(station)
dis <- read_rds("C:\\Users\\Mel\\Desktop\\quarterly_report\\data\\dis.rds")
if (max(dis$dates) < (Sys.Date() - 5)) {
  sdate <- max(dis$dates) + 1
  newdis <- importDVs(staid = station, code = '00060', stat = '00003', 
                      sdate= as.character(sdate))
  dis <- bind_rows(dis, newdis) %>%
    distinct() # In case there's repeated rows due to code failure
  write_rds(dis, "data/dis.rds")
}

dis2 <- dis %>%
  mutate(Datetime = paste(dates, " 12:00:00") %>% ymd_hms()) %>%
  filter(Datetime >= startDate & Datetime <= endDate)

dis3 <- dis2 %>%
 expand(Site=unique(wq2$Site), dates) %>%
  left_join(dis2) %>%
  mutate(Measure = "Discharge", minVal = -20, maxVal = val/1000-20) %>%
  select(Site, d2 = dates, Measure, minVal, maxVal)

```


```{r salinity_allsites, echo=FALSE, warning=FALSE, message = FALSE}

ggplot() +

  geom_ribbon(data= wq2, aes( x= Obs_Date, ymin = sal.mean - 1.96*sal.sd, ymax = sal.mean + 1.96*sal.sd), fill = "grey70") +
  
  geom_line(data= wq2, aes(x = Obs_Date, y = sal.mean, fill= "Salinity")) +
  
  geom_ribbon(data=dis3, aes(x= as.POSIXct(d2), ymax=maxVal, ymin=minVal, fill=Measure), 
              alpha=0.2) +
  
  xlab("Date") +
  
  scale_y_continuous(name = "Salinity(ppt)", 
                     limits=c(-20,40), 
                     breaks = seq(0, 40, 10),
                     sec.axis = sec_axis(~(.+30), 
                                         name = "River Discharge (1,000 cfs)
                                         ",
                                         breaks = seq(0, 30, 15))) +

  
  scale_fill_manual(values = c("#56B4E9", "#000000")) +
  
  theme(legend.position=("top"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = NA, colour = NA) ,
        panel.border = element_rect(color = "black", size = 1, fill = NA, linetype="solid"),
        axis.text=element_text(size=15),
        axis.title=element_text(size=17,face="bold"),
        plot.title =element_text(size=17, face='bold'),
        axis.text.x = element_text(angle = 65, hjust = 1, vjust = 1, face= "bold"),
        axis.text.y = element_text(face= "bold"),
        legend.title=element_blank(),
        legend.text=element_text(size=12),
        strip.text = element_text(size = 15)) +
  
 guides(fill = guide_legend(override.aes = list(colour = NULL, linetype = 0))) +
  
  facet_wrap(~ Site, ncol=3, labeller = label_both)


```
  
Figure 1.  Salinity and discharge data collected from autonomous sensors from the Lone Cabbage Reef restoration site near Suwannee, FL.  Each graph represents a sensor location, with top of page as north, and right of page as east.  The center column of figures (Sites 1-3) represent the eastern side of the Lone Cabbage Reef restoration site. The left column of figures (Sites 4-6) represent the western side of the Lone Cabbage Reef restoration site.  The right column of figures (Sites 7-9) represent sensors closest to shore in an area where salinity may be influenced by restoring Lone Cabbage Reef.  The first two columns from the west (Sites 1-6) represent the inshore and offshore sides of the restoration reef.  The primary y-axis is Salinity (ppt, parts per thousand), and the secondary y-axis is Suwannee River discharge (CFS, cubic feet per second) measured at USGS Wilcox station 02323500 on the Suwannee River.  River discharge is graphed as a daily mean in the light blue filled shape near the bottom of each graph. Salinity values (black line) are depicted using a 95% confidence interval, meaing that the interval is a range of values that are 95% certain to contain the true mean. Mean salinity and confidence interval values do not vary grealty. 


```{r alltemp_plots_processing, include= FALSE, warning=FALSE}

source("script/dailyFunctions.R")

# Sensor water quality carpentry
wq <- read.csv("data/wq.csv", header= T) %>%
  filter(Site != 0)
wq$Date <- wq$Date %>% ymd_hms %>% round_date(unit="hour")
wq$Site <- factor(wq$Site, levels = c("6", "1", "7", "5", "2", "8","4", "3", "9"))

sal_temp <- expand(wq, Site, Date=d) %>%
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Salinity, Temperature)
sal_temp$d2 <- date(sal_temp$Date)

dtemp <- seq(startDate, endDate, by = "hour")

temp_only <- expand(wq, Site, Date=dtemp) %>%
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Temperature)
temp_only$dtemp2 <- date(temp_only$Date)



```


```{r alltemp_sites, echo=FALSE, warning= FALSE, message= FALSE}
ggplot() +
  geom_smooth(data= temp_only, aes(x=dtemp2, y= Temperature, fill= "Temperature"),level= 0.95, se= TRUE, color= "#D55E00") +
  
  geom_ribbon(data=dis3, aes(x=d2, ymax=maxVal, ymin=minVal, fill=Measure), 
              alpha=0.4) +
  
  xlab("Date") +
  
   scale_y_continuous(name = "Temperature (C)", 
                     limits=c(-20,40), 
                     breaks = seq(0, 40, 10),
                     sec.axis = sec_axis(~(.+30), 
                                         name = "River Discharge (1,000 cfs)
                                         ",
                                         breaks = seq(0, 30, 15))) +
  scale_x_date(date_breaks = "5 months", date_labels = "%b %Y", expand = c(0, 0)) +
  
  scale_fill_manual(values = c("#56B4E9", "#D55E00")) +

  
 theme(legend.position=("top"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = NA, colour = NA) ,
        panel.border = element_rect(color = "black", size = 1, fill = NA, linetype="solid"),
        axis.text=element_text(size=15),
        axis.title=element_text(size=17,face="bold"),
        plot.title =element_text(size=17, face='bold'),
        axis.text.x = element_text(angle = 65, hjust = 1, vjust = 1, face= "bold"),
        axis.text.y = element_text(face= "bold"),
        legend.title=element_blank(),
        legend.text=element_text(size=12),
        strip.text = element_text(size = 15)) +
  
  guides(fill = guide_legend(override.aes = list(colour = NULL, linetype = 0))) +
  
  facet_wrap(~ Site, ncol=3, labeller = label_both)
```
  
Figure 2.  Temperature and discharge data collected from autonomous sensors from the Lone Cabbage Reef restoration site near Suwannee, FL.  Each graph represents a sensor location, with top of page as north, and right of page as east.  The center column of figures (Sites 1-3) represent the eastern side of the Lone Cabbage Reef restoration site. The left column of figures (Sites 4-6) represent the western side of the Lone Cabbage Reef restoration site.  The right column of figures (Sites 7-9) represent sensors close to shore in an area where salinity may be influenced by restoring Lone Cabbage Reef.  The first two columns from the west (Sites 1-6) represent the inshore and offshore sides of the restoration reef.  The primary y-axis is Temperature (C, Celsius), and the secondary y-axis is Suwannee River discharge (CFS, cubic feet per second) measured at USGS Wilcox station 02323500 on the Suwannee River.  River discharge is graphed as a daily mean in the light blue filled shape near the bottom of each graph. Temperature values (orange line) are depicted using a 95% confidence interval, meaing that the interval is a range of values that are 95% certain to contain the true mean. Mean temperature and confidence interval values do not vary grealty. 


```{r sal_789, warning= FALSE, message= FALSE, include= FALSE}

source("script/dailyFunctions.R")

# Sensor water quality carpentry
wq <- read.csv("data/wq.csv", header= T) %>%
  filter(Site != 0)
wq$Date <- wq$Date %>% ymd_hms %>% round_date(unit="hour")
wq$Site <- factor(wq$Site, levels = c("7", "8","9"))

sal_789 <- expand(wq, Site, Date=dsal) %>%
  filter(Site %in% c("7","8","9")) %>% 
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Salinity)

sal_789$dsal2 <- date(sal_789$Date)

dis3 <- dis2 %>%
 expand(Site=unique(sal_789$Site), dates) %>%
  left_join(dis2) %>%
  mutate(Measure = "Discharge", minVal = -20, maxVal = val/1000-20) %>%
  select(Site, d2 = dates, Measure, minVal, maxVal)


```


```{r sal_plot789, echo= FALSE, warning= FALSE, message= FALSE}
ggplot() +
  
 geom_smooth(data= sal_789, aes(x=dsal2, y= Salinity, fill= "Salinity"),level= 0.95, se= TRUE, color= "black") +


  geom_ribbon(data=dis3, aes(x=d2, ymax=maxVal, ymin=minVal, fill=Measure), 
              alpha=0.4) +
  
  xlab("Date") +
  
  scale_y_continuous(name = "Salinity(ppt)", 
                     limits=c(-20,40), 
                     breaks = seq(0, 40, 10),
                     sec.axis = sec_axis(~(.+30), 
                                         name = "River Discharge (1,000 cfs)
                                         ",
                                         breaks = seq(0, 30, 15))) +
  
  scale_x_date(date_breaks = "4 months", date_labels = "%b %Y", expand = c(0, 0)) +
  
  scale_fill_manual(values = c("#56B4E9", "#000000")) +
  
  theme(legend.position=("top"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = NA, colour = NA) ,
        panel.border = element_rect(color = "black", size = 1, fill = NA, linetype="solid"),
        axis.text=element_text(size=15),
        axis.title=element_text(size=17,face="bold"),
        plot.title =element_text(size=17, face='bold'),
        axis.text.x = element_text(angle = 65, hjust = 1, vjust = 1, face= "bold"),
        axis.text.y = element_text(face= "bold"),
        legend.title=element_blank(),
        legend.text=element_text(size=12),
        strip.text = element_text(size = 15)) +
  
 guides(fill = guide_legend(override.aes = list(colour = NULL, linetype = 0))) +
  
  facet_wrap(~ Site, ncol=1, labeller = label_both)

```
  
Figure 3. Salinity and discharge data collected from autonomous sensors from the Lone Cabbage Reef restoration site near Suwannee, FL.  Each graph represents a sensor location, with top of page as north, and right of page as east.  The figures (Sites 7-9) represent sensors close to shore in an area where salinity may be influenced by restoring Lone Cabbage Reef.  The primary y-axis is Salinity (ppt, parts per thousand), and the secondary y-axis is Suwannee River discharge (CFS, cubic feet per second) measured at USGS Wilcox station 02323500 on the Suwannee River.  River discharge is graphed as a daily mean in the light blue filled shape near the bottom of each graph. Salinity values (black line) are depicted using a 95% confidence interval, meaing that the interval is a range of values that are 95% certain to contain the true mean. Mean salinity and confidence interval values do not vary grealty. 


```{r temp_789, warning=FALSE, include= FALSE}

# Sensor water quality carpentry
wq <- read.csv("data/wq.csv", header= T) %>%
  filter(Site != 0)
wq$Date <- wq$Date %>% ymd_hms %>% round_date(unit="hour")
wq$Site <- factor(wq$Site, levels = c( "7", "8", "9"))


dtemp <- seq(startDate, endDate, by = "hour")

temp_789 <- expand(wq, Site, Date=dtemp) %>%
  filter(Site %in% c("7","8","9")) %>%
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Temperature)

temp_789$dtemp2 <- date(temp_789$Date)

# Calculate mean, min and max daily Sal and Temp
# Note: tidyr's gather is in use here, by converting the "wide" table to
# "long" one, we can use the aes(color=Measure) in ggplot
# Note2: I've created functions in dailyFunction.R to make calculating daily mean, min,
# max easy. The function allows certain proportions of NA here. In this example, 0.75
# of the daily numbers can be NA, and we'll still calculate the meant, min, max

dis3 <- dis2 %>%
  expand(Site=unique(temp_789$Site), dates) %>%
  left_join(dis2) %>%
  mutate(Measure = "Discharge", minVal = -20, maxVal = val/1000 - 20) %>%
  select(Site, d2 = dates, Measure, minVal, maxVal)


```

```{r temp_plot789, echo= FALSE, warning= FALSE, message= FALSE}

ggplot() +

   geom_smooth(data= temp_789, aes(x=dtemp2, y= Temperature, fill= "Temperature"),level= 0.95, se= TRUE, color= "#D55E00") +
  
  geom_ribbon(data=dis3, aes(x=d2, ymax=maxVal, ymin=minVal, fill=Measure), 
              alpha=0.4) +
  
  xlab("Date") +
  
   scale_y_continuous(name = "Temperature (C)", 
                     limits=c(-20,40), 
                     breaks = seq(0, 40, 10),
                     sec.axis = sec_axis(~(.+30), 
                                         name = "River Discharge (1,000 cfs)
                                         ",
                                         breaks = seq(0, 30, 15))) +
  scale_x_date(date_breaks = "5 months", date_labels = "%b %Y", expand = c(0, 0)) +
  
  scale_fill_manual(values = c("#56B4E9", "#D55E00")) +

  
 theme(legend.position=("top"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = NA, colour = NA) ,
        panel.border = element_rect(color = "black", size = 1, fill = NA, linetype="solid"),
        axis.text=element_text(size=15),
        axis.title=element_text(size=17,face="bold"),
        plot.title =element_text(size=17, face='bold'),
        axis.text.x = element_text(angle = 65, hjust = 1, vjust = 1, face= "bold"),
        axis.text.y = element_text(face= "bold"),
        legend.title=element_blank(),
        legend.text=element_text(size=12),
        strip.text = element_text(size = 15)) +
  
  guides(fill = guide_legend(override.aes = list(colour = NULL, linetype = 0))) +
  
  facet_wrap(~ Site, ncol=1, labeller = label_both)

```
  
Figure 4.  Temperature and discharge data collected from autonomous sensors from the Lone Cabbage Reef restoration site near Suwannee, FL.  Each graph represents a sensor location, with top of page as north, and right of page as east.  The figures (Sites 7-9) represent sensors close to shore in an area where salinity may be influenced by restoring Lone Cabbage Reef.  The primary y-axis is Temperature (C, Celsius), and the secondary y-axis is Suwannee River discharge (CFS, cubic feet per second) measured at USGS Wilcox station 02323500 on the Suwannee River.  River discharge is graphed as a daily mean in the light blue filled shape near the bottom of each graph. Temperature values (orange line) are depicted using a 95% confidence interval, meaing that the interval is a range of values that are 95% certain to contain the true mean. Mean temperature and confidence interval values do not vary grealty. 


```{r sal_654, warning= FALSE, message= FALSE, include= FALSE}

# Sensor water quality carpentry
wq <- read.csv("data/wq.csv", header= T) %>%
  filter(Site != 0)
wq$Date <- wq$Date %>% ymd_hms %>% round_date(unit="hour")
wq$Site <- factor(wq$Site, levels = c("6", "5","4"))


dsal <- seq(startDate, endDate, by = "hour")

sal_654<- expand(wq, Site, Date=dsal) %>%
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Salinity)

sal_654$dsal2 <- date(sal_654$Date)


dis3 <- dis2 %>%
  expand(Site=unique(sal_654$Site), dates) %>%
  left_join(dis2) %>%
  mutate(Measure = "Discharge", minVal = -20, maxVal = val/1000 - 20) %>%
  select(Site, d2 = dates, Measure, minVal, maxVal)

```

```{r sal_plot654, echo=FALSE, warning= FALSE, message= FALSE}
ggplot() +
  
 geom_smooth(data= sal_654, aes(x=dsal2, y= Salinity, fill= "Salinity"),level= 0.95, se= TRUE, color= "black") +


  geom_ribbon(data=dis3, aes(x=d2, ymax=maxVal, ymin=minVal, fill=Measure), 
              alpha=0.4) +
  
  xlab("Date") +
  
  scale_y_continuous(name = "Salinity(ppt)", 
                     limits=c(-20,40), 
                     breaks = seq(0, 40, 10),
                     sec.axis = sec_axis(~(.+30), 
                                         name = "River Discharge (1,000 cfs)
                                         ",
                                         breaks = seq(0, 30, 15))) +
  
  scale_x_date(date_breaks = "4 months", date_labels = "%b %Y", expand = c(0, 0)) +
  
  scale_fill_manual(values = c("#56B4E9", "#000000")) +
  
  theme(legend.position=("top"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = NA, colour = NA) ,
        panel.border = element_rect(color = "black", size = 1, fill = NA, linetype="solid"),
        axis.text=element_text(size=15),
        axis.title=element_text(size=17,face="bold"),
        plot.title =element_text(size=17, face='bold'),
        axis.text.x = element_text(angle = 65, hjust = 1, vjust = 1, face= "bold"),
        axis.text.y = element_text(face= "bold"),
        legend.title=element_blank(),
        legend.text=element_text(size=12),
        strip.text = element_text(size = 15)) +
  
 guides(fill = guide_legend(override.aes = list(colour = NULL, linetype = 0))) +
  
  facet_wrap(~ Site, ncol=1, labeller = label_both)


```
  
Figure 5.  Salinity and discharge data collected from autonomous sensors from the Lone Cabbage Reef restoration site near Suwannee, FL.  Each graph represents a sensor location, with top of page as north, and right of page as east.  The figures (Sites 4-6) represent the western side of the Lone Cabbage Reef restoration site. The primary y-axis is Salinity (ppt, parts per thousand), and the secondary y-axis is Suwannee River discharge (CFS, cubic feet per second) measured at USGS Wilcox station 02323500 on the Suwannee River.  River discharge is graphed as a daily mean in the light blue filled shape near the bottom of each graph. Salinity values (black line) are depicted using a 95% confidence interval, meaing that the interval is a range of values that are 95% certain to contain the true mean. Mean salinity and confidence interval values do not vary grealty. 

```{r temp_654, warning= FALSE, message= FALSE, include= FALSE}
# Sensor water quality carpentry
wq <- read.csv("data/wq.csv", header= T) %>%
  filter(Site != 0)
wq$Date <- wq$Date %>% ymd_hms %>% round_date(unit="hour")
wq$Site <- factor(wq$Site, levels = c("6",  "5", "4"))

sal_temp <- expand(wq, Site, Date=d) %>%
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Salinity, Temperature)

sal_temp$d2 <- date(sal_temp$Date)

dtemp <- seq(startDate, endDate, by = "hour")

temp_654 <- expand(wq, Site, Date=dtemp) %>%
  filter(Site %in% c("6","5","4"))%>%
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Temperature)

temp_654$dtemp2 <- date(temp_654$Date)


dis3 <- dis2 %>%
  expand(Site=unique(temp_654$Site), dates) %>%
  left_join(dis2) %>%
  mutate(Measure = "Discharge", minVal = -20, maxVal = val/1000 - 20) %>%
  select(Site, d2 = dates, Measure, minVal, maxVal)


```



```{r temp_plot654, echo= FALSE, warning= FALSE, message= FALSE}
ggplot() +

   geom_smooth(data= temp_654, aes(x=dtemp2, y= Temperature, fill= "Temperature"),level= 0.95, se= TRUE, color= "#D55E00") +
  
  geom_ribbon(data=dis3, aes(x=d2, ymax=maxVal, ymin=minVal, fill=Measure), 
              alpha=0.4) +
  
  xlab("Date") +
  
   scale_y_continuous(name = "Temperature (C)", 
                     limits=c(-20,40), 
                     breaks = seq(0, 40, 10),
                     sec.axis = sec_axis(~(.+30), 
                                         name = "River Discharge (1,000 cfs)
                                         ",
                                         breaks = seq(0, 30, 15))) +
  scale_x_date(date_breaks = "5 months", date_labels = "%b %Y", expand = c(0, 0)) +
  
  scale_fill_manual(values = c("#56B4E9", "#D55E00")) +

  
 theme(legend.position=("top"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = NA, colour = NA) ,
        panel.border = element_rect(color = "black", size = 1, fill = NA, linetype="solid"),
        axis.text=element_text(size=15),
        axis.title=element_text(size=17,face="bold"),
        plot.title =element_text(size=17, face='bold'),
        axis.text.x = element_text(angle = 65, hjust = 1, vjust = 1, face= "bold"),
        axis.text.y = element_text(face= "bold"),
        legend.title=element_blank(),
        legend.text=element_text(size=12),
        strip.text = element_text(size = 15)) +
  
  guides(fill = guide_legend(override.aes = list(colour = NULL, linetype = 0))) +
  
  facet_wrap(~ Site, ncol=1, labeller = label_both)

```
    
Figure 6.  Temperature and discharge data collected from autonomous sensors from the Lone Cabbage Reef restoration site near Suwannee, FL.  Each graph represents a sensor location, with top of page as north, and right of page as east.  The figures (Sites 4-6) represent the western side of the Lone Cabbage Reef restoration site.  The primary y-axis is Temperature (C, Celsius), and the secondary y-axis is Suwannee River discharge (CFS, cubic feet per second) measured at USGS Wilcox station 02323500 on the Suwannee River.  River discharge is graphed as a daily mean in the light blue filled shape near the bottom of each graph. Temperature values (orange line) are depicted using a 95% confidence interval, meaing that the interval is a range of values that are 95% certain to contain the true mean. Mean temperature and confidence interval values do not vary grealty. 


```{r sal_123, warning= FALSE, message= FALSE, include= FALSE}

source("script/dailyFunctions.R")

# Sensor water quality carpentry
wq <- read.csv("data/wq.csv", header= T) %>%
  filter(Site != 0)
wq$Date <- wq$Date %>% ymd_hms %>% round_date(unit="hour")
wq$Site <- factor(wq$Site, levels = c("1","2", "3"))


dsal <- seq(startDate, endDate, by = "hour")

sal_123 <- expand(wq, Site, Date=dsal) %>%
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Salinity)

sal_123$dsal2 <- date(sal_123$Date)


dis3 <- dis2 %>%
  expand(Site=unique(sal_123$Site), dates) %>%
  left_join(dis2) %>%
  mutate(Measure = "Discharge", minVal = -20, maxVal = val/1000 - 20) %>%
  select(Site, d2 = dates, Measure, minVal, maxVal)


```

```{r sal_plot123, echo= FALSE, warning= FALSE, message= FALSE}

ggplot() +
  
 geom_smooth(data= sal_123, aes(x=dsal2, y= Salinity, fill= "Salinity"),level= 0.95, se= TRUE, color= "black") +


  geom_ribbon(data=dis3, aes(x=d2, ymax=maxVal, ymin=minVal, fill=Measure), 
              alpha=0.4) +
  
  xlab("Date") +
  
  scale_y_continuous(name = "Salinity(ppt)", 
                     limits=c(-20,40), 
                     breaks = seq(0, 40, 10),
                     sec.axis = sec_axis(~(.+30), 
                                         name = "River Discharge (1,000 cfs)
                                         ",
                                         breaks = seq(0, 30, 15))) +
  
  scale_x_date(date_breaks = "4 months", date_labels = "%b %Y", expand = c(0, 0)) +
  
  scale_fill_manual(values = c("#56B4E9", "#000000")) +
  
  theme(legend.position=("top"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = NA, colour = NA) ,
        panel.border = element_rect(color = "black", size = 1, fill = NA, linetype="solid"),
        axis.text=element_text(size=15),
        axis.title=element_text(size=17,face="bold"),
        plot.title =element_text(size=17, face='bold'),
        axis.text.x = element_text(angle = 65, hjust = 1, vjust = 1, face= "bold"),
        axis.text.y = element_text(face= "bold"),
        legend.title=element_blank(),
        legend.text=element_text(size=12),
        strip.text = element_text(size = 15)) +
  
 guides(fill = guide_legend(override.aes = list(colour = NULL, linetype = 0))) +
  
  facet_wrap(~ Site, ncol=1, labeller = label_both)

```
  
Figure 7.  Salinity and discharge data collected from autonomous sensors from the Lone Cabbage Reef restoration site near Suwannee, FL.  The figures (Sites 1-3) represent the eastern side of the Lone Cabbage Reef restoration site. The primary y-axis is Salinity (ppt, parts per thousand), and the secondary y-axis is Suwannee River discharge (CFS, cubic feet per second) measured at USGS Wilcox station 02323500 on the Suwannee River.  River discharge is graphed as a daily mean in the light blue filled shape near the bottom of each graph. Salinity values (black line) are depicted using a 95% confidence interval, meaing that the interval is a range of values that are 95% certain to contain the true mean. Mean salinity and confidence interval values do not vary grealty. 


```{r temp_123, warning= FALSE, message= FALSE, include = FALSE}

source("script/dailyFunctions.R")

# Sensor water quality carpentry
wq <- read.csv("data/wq.csv", header= T) %>%
  filter(Site != 0)
wq$Date <- wq$Date %>% ymd_hms %>% round_date(unit="hour")
wq$Site <- factor(wq$Site, levels = c("1","2","3"))

sal_temp <- expand(wq, Site, Date=d) %>%
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Salinity, Temperature)
sal_temp$d2 <- date(sal_temp$Date)

dtemp <- seq(startDate, endDate, by = "hour")

temp_123 <- expand(wq, Site, Date=dtemp) %>%
  left_join(wq, by=c("Site" = "Site", "Date" = "Date")) %>%
  select(Site, Date, Temperature)
temp_123$dtemp2 <- date(temp_123$Date)

dis3 <- dis2 %>%
  expand(Site=unique(temp_123$Site), dates) %>%
  left_join(dis2) %>%
  mutate(Measure = "Discharge", minVal = -20, maxVal = val/1000 - 20) %>%
  select(Site, d2 = dates, Measure, minVal, maxVal)

```


```{r temp_plot123, echo=FALSE, warning= FALSE, message= FALSE}

ggplot() +

   geom_smooth(data= temp_123, aes(x=dtemp2, y= Temperature, fill= "Temperature"),level= 0.95, se= TRUE, color= "#D55E00") +
  
  geom_ribbon(data=dis3, aes(x=d2, ymax=maxVal, ymin=minVal, fill=Measure), 
              alpha=0.4) +
  
  xlab("Date") +
  
   scale_y_continuous(name = "Temperature (C)", 
                     limits=c(-20,40), 
                     breaks = seq(0, 40, 10),
                     sec.axis = sec_axis(~(.+30), 
                                         name = "River Discharge (1,000 cfs)
                                         ",
                                         breaks = seq(0, 30, 15))) +
  scale_x_date(date_breaks = "5 months", date_labels = "%b %Y", expand = c(0, 0)) +
  
  scale_fill_manual(values = c("#56B4E9", "#D55E00")) +

  
 theme(legend.position=("top"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = NA, colour = NA) ,
        panel.border = element_rect(color = "black", size = 1, fill = NA, linetype="solid"),
        axis.text=element_text(size=15),
        axis.title=element_text(size=17,face="bold"),
        plot.title =element_text(size=17, face='bold'),
        axis.text.x = element_text(angle = 65, hjust = 1, vjust = 1, face= "bold"),
        axis.text.y = element_text(face= "bold"),
        legend.title=element_blank(),
        legend.text=element_text(size=12),
        strip.text = element_text(size = 15)) +
  
  guides(fill = guide_legend(override.aes = list(colour = NULL, linetype = 0))) +
  
  facet_wrap(~ Site, ncol=1, labeller = label_both)


```
  
  
Figure 8.  Temperature and discharge data collected from autonomous sensors from the Lone Cabbage Reef restoration site near Suwannee, FL.  The figures (Sites 1-3) represent the eastern side of the Lone Cabbage Reef restoration site. The primary y-axis is Temperature (C, Celsius), and the secondary y-axis is Suwannee River discharge (CFS, cubic feet per second) measured at USGS Wilcox station 02323500 on the Suwannee River.  River discharge is graphed as a daily mean in the light blue filled shape near the bottom of each graph. Daily mean Temperature values (orange line) are depicted using a 95% confidence interval, meaing that the interval is a range of values that are 95% certain to contain the true mean. Mean temperature and confidence interval values do not vary grealty. 


